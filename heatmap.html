<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balaji's X Topics - Engagement Heatmap</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #0f0f1a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 40px 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #00d9ff 0%, #a855f7 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
        }
        
        .subtitle {
            color: #888;
            font-size: 1.1rem;
        }
        
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-group label {
            color: #888;
            font-size: 0.9rem;
        }
        
        select {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff;
            padding: 8px 12px;
            border-radius: 8px;
            font-family: inherit;
            cursor: pointer;
        }
        
        select:focus {
            outline: none;
            border-color: #00d9ff;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .legend-bar {
            width: 200px;
            height: 16px;
            border-radius: 8px;
            background: linear-gradient(90deg, #1a1a2e 0%, #00d9ff 50%, #a855f7 100%);
        }
        
        .legend-label {
            font-size: 0.8rem;
            color: #888;
        }
        
        .heatmap-container {
            overflow-x: auto;
            border-radius: 16px;
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }
        
        th {
            background: rgba(0,0,0,0.3);
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #aaa;
            cursor: pointer;
            transition: color 0.2s;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            white-space: nowrap;
        }
        
        th:hover {
            color: #00d9ff;
        }
        
        th.sorted {
            color: #00d9ff;
        }
        
        th.sorted::after {
            content: ' ↓';
        }
        
        th.sorted.asc::after {
            content: ' ↑';
        }
        
        .topic-col {
            min-width: 220px;
        }
        
        td {
            padding: 14px 12px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            transition: background 0.2s;
        }
        
        tr:hover td {
            background: rgba(255,255,255,0.03);
        }
        
        .topic-cell {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .topic-name {
            font-weight: 600;
            color: #fff;
        }
        
        .topic-keywords {
            font-size: 0.75rem;
            color: #666;
        }
        
        .topic-count {
            font-size: 0.75rem;
            color: #888;
            background: rgba(255,255,255,0.1);
            padding: 2px 8px;
            border-radius: 10px;
            display: inline-block;
            margin-top: 4px;
        }
        
        .heat-cell {
            padding: 12px;
            border-radius: 6px;
            text-align: center;
            font-weight: 500;
            transition: transform 0.2s;
            position: relative;
        }
        
        .heat-cell:hover {
            transform: scale(1.05);
            z-index: 10;
        }
        
        .heat-value {
            font-size: 0.95rem;
        }
        
        .tooltip {
            display: none;
            position: fixed;
            background: rgba(0,0,0,0.95);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            z-index: 1000;
            pointer-events: none;
            max-width: 300px;
        }
        
        .tooltip-title {
            font-weight: 600;
            color: #00d9ff;
            margin-bottom: 8px;
        }
        
        .tooltip-row {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin: 4px 0;
        }
        
        .tooltip-label {
            color: #888;
        }
        
        .tooltip-value {
            color: #fff;
            font-weight: 500;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            color: #555;
            font-size: 0.85rem;
        }
        
        footer a {
            color: #00d9ff;
            text-decoration: none;
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 1.8rem; }
            .controls { flex-direction: column; align-items: stretch; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Balaji's X Topics Engagement</h1>
            <p class="subtitle">Heatmap of engagement metrics across 46 topics from @balajis tweets</p>
        </header>
        
        <div class="controls">
            <div class="control-group">
                <label>Sort by:</label>
                <select id="sortBy">
                    <option value="engagement_rate">Engagement Rate</option>
                    <option value="likeCount_mean">Avg Likes</option>
                    <option value="retweetCount_mean">Avg Retweets</option>
                    <option value="replyCount_mean">Avg Replies</option>
                    <option value="viewCount_mean">Avg Views</option>
                    <option value="tweet_count">Tweet Count</option>
                </select>
            </div>
            <div class="control-group">
                <label>Normalize:</label>
                <select id="normalizeBy">
                    <option value="column">By Column (compare metrics)</option>
                    <option value="row">By Row (compare topics)</option>
                </select>
            </div>
        </div>
        
        <div class="legend">
            <span class="legend-label">Low</span>
            <div class="legend-bar"></div>
            <span class="legend-label">High</span>
        </div>
        
        <div class="heatmap-container">
            <table id="heatmap">
                <thead>
                    <tr>
                        <th class="topic-col">Topic</th>
                        <th data-col="likeCount_mean">Avg Likes</th>
                        <th data-col="retweetCount_mean">Avg RTs</th>
                        <th data-col="replyCount_mean">Avg Replies</th>
                        <th data-col="bookmarkCount_mean">Avg Saves</th>
                        <th data-col="engagement_rate" class="sorted">Eng. Rate</th>
                    </tr>
                </thead>
                <tbody id="heatmapBody"></tbody>
            </table>
        </div>
        
        <footer>
            <p>Data from <a href="https://x.com/balajis" target="_blank">@balajis</a> • 
            <a href="index.html">View 3D Topic Space</a></p>
        </footer>
    </div>
    
    <div class="tooltip" id="tooltip"></div>
    
    <script>
        const topicData = [{"topic_id": 0, "topic_name": "Humanizing AI", "tweet_count": 257, "keywords": ["ai", "use", "intelligence", "open", "models"], "likeCount_total": 141925.0, "likeCount_mean": 642.1945701357, "likeCount_median": 182.0, "retweetCount_total": 15838.0, "retweetCount_mean": 71.665158371, "retweetCount_median": 17.0, "replyCount_total": 9796.0, "replyCount_mean": 44.3257918552, "replyCount_median": 15.0, "viewCount_total": 22486822.0, "viewCount_mean": 112999.1055276382, "viewCount_median": 55124.0, "bookmarkCount_total": 42277.0, "bookmarkCount_mean": 191.2986425339, "bookmarkCount_median": 21.0, "quoteCount_total": 2846.0, "quoteCount_mean": 12.8778280543, "quoteCount_median": 2.0, "engagement_rate": 0.0074514309}, {"topic_id": 1, "topic_name": "Central Bank Turmoil", "tweet_count": 209, "keywords": ["fed", "banks", "bank", "rates", "losses"], "likeCount_total": 105301.0, "likeCount_mean": 526.505, "likeCount_median": 189.0, "retweetCount_total": 18364.0, "retweetCount_mean": 91.82, "retweetCount_median": 20.0, "replyCount_total": 7173.0, "replyCount_mean": 35.865, "replyCount_median": 15.0, "viewCount_total": 50717967.0, "viewCount_mean": 254864.1557788945, "viewCount_median": 89041.0, "bookmarkCount_total": 12125.0, "bookmarkCount_mean": 60.625, "bookmarkCount_median": 13.5, "quoteCount_total": 3748.0, "quoteCount_mean": 18.74, "quoteCount_median": 4.0, "engagement_rate": 0.002579717}, {"topic_id": 2, "topic_name": "Network State Concept", "tweet_count": 96, "keywords": ["network", "network school", "school", "rt", "network state"], "likeCount_total": 15264.0, "likeCount_mean": 227.8208955224, "likeCount_median": 4.0, "retweetCount_total": 2815.0, "retweetCount_mean": 42.0149253731, "retweetCount_median": 23.0, "replyCount_total": 1272.0, "replyCount_mean": 18.9850746269, "replyCount_median": 0.0, "viewCount_total": 7081516.0, "viewCount_mean": 136183.0, "viewCount_median": 14173.5, "bookmarkCount_total": 2138.0, "bookmarkCount_mean": 31.9104477612, "bookmarkCount_median": 0.0, "quoteCount_total": 394.0, "quoteCount_mean": 5.8805970149, "quoteCount_median": 0.0, "engagement_rate": 0.002732607}, {"topic_id": 3, "topic_name": "Bitcoin and Fiat Devaluation", "tweet_count": 103, "keywords": ["bitcoin", "btc", "dollar", "fed", "usd"], "likeCount_total": 164103.0, "likeCount_mean": 1764.5483870968, "likeCount_median": 1173.0, "retweetCount_total": 27655.0, "retweetCount_mean": 297.3655913978, "retweetCount_median": 150.0, "replyCount_total": 15583.0, "replyCount_mean": 167.5591397849, "replyCount_median": 77.0, "viewCount_total": 71755645.0, "viewCount_mean": 815405.0568181818, "viewCount_median": 334251.5, "bookmarkCount_total": 25776.0, "bookmarkCount_mean": 277.1612903226, "bookmarkCount_median": 78.0, "quoteCount_total": 7884.0, "quoteCount_mean": 84.7741935484, "quoteCount_median": 22.0, "engagement_rate": 0.0028895427}, {"topic_id": 4, "topic_name": "Communist Ideology Evolution", "tweet_count": 81, "keywords": ["soviet", "left", "communism", "russian", "russia"], "likeCount_total": 52573.0, "likeCount_mean": 922.3333333333, "likeCount_median": 331.0, "retweetCount_total": 5358.0, "retweetCount_mean": 94.0, "retweetCount_median": 39.0, "replyCount_total": 2935.0, "replyCount_mean": 51.4912280702, "replyCount_median": 18.0, "viewCount_total": 10385047.0, "viewCount_mean": 182193.8070175438, "viewCount_median": 63139.0, "bookmarkCount_total": 9715.0, "bookmarkCount_mean": 170.4385964912, "bookmarkCount_median": 47.0, "quoteCount_total": 755.0, "quoteCount_mean": 13.2456140351, "quoteCount_median": 3.0, "engagement_rate": 0.0058609268}, {"topic_id": 5, "topic_name": "Reclaiming Democracy Now", "tweet_count": 72, "keywords": ["democracy", "democrats", "party", "democrat", "primary"], "likeCount_total": 10146.0, "likeCount_mean": 507.3, "likeCount_median": 443.5, "retweetCount_total": 1256.0, "retweetCount_mean": 62.8, "retweetCount_median": 41.5, "replyCount_total": 650.0, "replyCount_mean": 32.5, "replyCount_median": 29.5, "viewCount_total": 2741067.0, "viewCount_mean": 137053.35, "viewCount_median": 93825.5, "bookmarkCount_total": 988.0, "bookmarkCount_mean": 49.4, "bookmarkCount_median": 23.5, "quoteCount_total": 161.0, "quoteCount_mean": 8.05, "quoteCount_median": 5.5, "engagement_rate": 0.004396828}, {"topic_id": 6, "topic_name": "Global Economic Shifts", "tweet_count": 67, "keywords": ["india", "indian", "pakistan", "indians", "indias"], "likeCount_total": 85189.0, "likeCount_mean": 1494.5438596491, "likeCount_median": 566.0, "retweetCount_total": 11291.0, "retweetCount_mean": 198.0877192982, "retweetCount_median": 64.0, "replyCount_total": 4149.0, "replyCount_mean": 72.7894736842, "replyCount_median": 26.0, "viewCount_total": 14189722.0, "viewCount_mean": 308472.2173913043, "viewCount_median": 100242.0, "bookmarkCount_total": 14711.0, "bookmarkCount_mean": 258.0877192982, "bookmarkCount_median": 44.0, "quoteCount_total": 1908.0, "quoteCount_mean": 33.4736842105, "quoteCount_median": 6.0, "engagement_rate": 0.0070916823}, {"topic_id": 7, "topic_name": "Internet Global Governance", "tweet_count": 61, "keywords": ["internet", "values", "vs", "law", "cloud"], "likeCount_total": 121060.0, "likeCount_mean": 2087.2413793103, "likeCount_median": 224.5, "retweetCount_total": 10058.0, "retweetCount_mean": 173.4137931034, "retweetCount_median": 25.5, "replyCount_total": 2939.0, "replyCount_mean": 50.6724137931, "replyCount_median": 21.5, "viewCount_total": 1394196232.0, "viewCount_mean": 26305589.28301887, "viewCount_median": 81000.0, "bookmarkCount_total": 18351.0, "bookmarkCount_mean": 316.3965517241, "bookmarkCount_median": 38.5, "quoteCount_total": 1184.0, "quoteCount_mean": 20.4137931034, "quoteCount_median": 5.0, "engagement_rate": 9.61536e-05}, {"topic_id": 8, "topic_name": "Crypto Scandal Fallout", "tweet_count": 55, "keywords": ["sbf", "ftx", "stolen", "donations", "funds"], "likeCount_total": 88088.0, "likeCount_mean": 1835.1666666667, "likeCount_median": 727.5, "retweetCount_total": 16700.0, "retweetCount_mean": 347.9166666667, "retweetCount_median": 117.0, "replyCount_total": 3482.0, "replyCount_mean": 72.5416666667, "replyCount_median": 26.0, "viewCount_total": 1157415.0, "viewCount_mean": 192902.5, "viewCount_median": 124533.0, "bookmarkCount_total": 3234.0, "bookmarkCount_mean": 67.375, "bookmarkCount_median": 22.0, "quoteCount_total": 1550.0, "quoteCount_mean": 32.2916666667, "quoteCount_median": 9.0, "engagement_rate": 0.0935446663}, {"topic_id": 9, "topic_name": "Digital Presence Management", "tweet_count": 50, "keywords": ["httpstco1mg0ugbeb3", "essay", "molsonhart", "thread", "post"], "likeCount_total": 2379.0, "likeCount_mean": 62.6052631579, "likeCount_median": 11.0, "retweetCount_total": 2261.0, "retweetCount_mean": 59.5, "retweetCount_median": 1.0, "replyCount_total": 177.0, "replyCount_mean": 4.6578947368, "replyCount_median": 1.0, "viewCount_total": 793369.0, "viewCount_mean": 21442.4054054054, "viewCount_median": 4578.0, "bookmarkCount_total": 764.0, "bookmarkCount_mean": 20.1052631579, "bookmarkCount_median": 0.0, "quoteCount_total": 17.0, "quoteCount_mean": 0.4473684211, "quoteCount_median": 0.0, "engagement_rate": 0.0060715758}, {"topic_id": 10, "topic_name": "China's Industrial Shift", "tweet_count": 49, "keywords": ["china", "factory", "tech", "robotics", "make"], "likeCount_total": 28715.0, "likeCount_mean": 667.7906976744, "likeCount_median": 233.0, "retweetCount_total": 4252.0, "retweetCount_mean": 98.8837209302, "retweetCount_median": 18.0, "replyCount_total": 1622.0, "replyCount_mean": 37.7209302326, "replyCount_median": 13.0, "viewCount_total": 8990224.0, "viewCount_mean": 214052.9523809524, "viewCount_median": 63796.0, "bookmarkCount_total": 10987.0, "bookmarkCount_mean": 255.511627907, "bookmarkCount_median": 17.0, "quoteCount_total": 897.0, "quoteCount_mean": 20.8604651163, "quoteCount_median": 2.0, "engagement_rate": 0.0038474014}, {"topic_id": 11, "topic_name": "Empire Resilience Dynamics", "tweet_count": 46, "keywords": ["empire", "global", "country", "american empire", "american"], "likeCount_total": 31493.0, "likeCount_mean": 732.3953488372, "likeCount_median": 347.0, "retweetCount_total": 3448.0, "retweetCount_mean": 80.1860465116, "retweetCount_median": 34.0, "replyCount_total": 2826.0, "replyCount_mean": 65.7209302326, "replyCount_median": 27.0, "viewCount_total": 6613115.0, "viewCount_mean": 153793.3720930233, "viewCount_median": 100599.0, "bookmarkCount_total": 10252.0, "bookmarkCount_mean": 238.4186046512, "bookmarkCount_median": 50.0, "quoteCount_total": 726.0, "quoteCount_mean": 16.8837209302, "quoteCount_median": 6.0, "engagement_rate": 0.0057109244}, {"topic_id": 12, "topic_name": "Tech Lawsuit Takedowns", "tweet_count": 43, "keywords": ["media", "antitech", "journalists", "journos", "tech"], "likeCount_total": 11988.0, "likeCount_mean": 399.6, "likeCount_median": 225.5, "retweetCount_total": 5837.0, "retweetCount_mean": 194.5666666667, "retweetCount_median": 27.0, "replyCount_total": 630.0, "replyCount_mean": 21.0, "replyCount_median": 10.0, "viewCount_total": 3023713.0, "viewCount_mean": 137441.5, "viewCount_median": 59990.0, "bookmarkCount_total": 1126.0, "bookmarkCount_mean": 37.5333333333, "bookmarkCount_median": 16.5, "quoteCount_total": 163.0, "quoteCount_mean": 5.4333333333, "quoteCount_median": 1.5, "engagement_rate": 0.0061034232}, {"topic_id": 13, "topic_name": "Sustainable Transportation", "tweet_count": 39, "keywords": ["flying", "cars", "drones", "drone", "aviation"], "likeCount_total": 39483.0, "likeCount_mean": 1645.125, "likeCount_median": 188.0, "retweetCount_total": 3862.0, "retweetCount_mean": 160.9166666667, "retweetCount_median": 12.0, "replyCount_total": 2256.0, "replyCount_mean": 94.0, "replyCount_median": 21.5, "viewCount_total": 15278320.0, "viewCount_mean": 727539.0476190476, "viewCount_median": 83646.0, "bookmarkCount_total": 6227.0, "bookmarkCount_mean": 259.4583333333, "bookmarkCount_median": 16.5, "quoteCount_total": 772.0, "quoteCount_mean": 32.1666666667, "quoteCount_median": 2.0, "engagement_rate": 0.0029846868}, {"topic_id": 14, "topic_name": "Elon Support Network", "tweet_count": 37, "keywords": ["elon", "gensler", "biden", "56b", "kamala"], "likeCount_total": 16702.0, "likeCount_mean": 1391.8333333333, "likeCount_median": 566.5, "retweetCount_total": 1207.0, "retweetCount_mean": 100.5833333333, "retweetCount_median": 41.5, "replyCount_total": 644.0, "replyCount_mean": 53.6666666667, "replyCount_median": 32.0, "viewCount_total": 2706463.0, "viewCount_mean": 270646.3, "viewCount_median": 136192.5, "bookmarkCount_total": 1124.0, "bookmarkCount_mean": 93.6666666667, "bookmarkCount_median": 15.5, "quoteCount_total": 104.0, "quoteCount_mean": 8.6666666667, "quoteCount_median": 3.5, "engagement_rate": 0.0068550725}, {"topic_id": 15, "topic_name": "Anti-Establishment Dissent", "tweet_count": 32, "keywords": ["statism", "pivot", "wokism", "establishment", "police"], "likeCount_total": 6143.0, "likeCount_mean": 227.5185185185, "likeCount_median": 171.0, "retweetCount_total": 821.0, "retweetCount_mean": 30.4074074074, "retweetCount_median": 25.0, "replyCount_total": 262.0, "replyCount_mean": 9.7037037037, "replyCount_median": 7.0, "viewCount_total": 1391842.0, "viewCount_mean": 66278.1904761905, "viewCount_median": 41792.0, "bookmarkCount_total": 432.0, "bookmarkCount_mean": 16.0, "bookmarkCount_median": 12.0, "quoteCount_total": 65.0, "quoteCount_mean": 2.4074074074, "quoteCount_median": 1.0, "engagement_rate": 0.0051916812}, {"topic_id": 16, "topic_name": "Gold vs Fiat Currencies", "tweet_count": 31, "keywords": ["gold", "central banks", "central", "dollar", "reserves"], "likeCount_total": 42291.0, "likeCount_mean": 1626.5769230769, "likeCount_median": 692.5, "retweetCount_total": 6165.0, "retweetCount_mean": 237.1153846154, "retweetCount_median": 79.0, "replyCount_total": 2327.0, "replyCount_mean": 89.5, "replyCount_median": 52.0, "viewCount_total": 6121600.0, "viewCount_mean": 235446.1538461538, "viewCount_median": 121680.0, "bookmarkCount_total": 6858.0, "bookmarkCount_mean": 263.7692307692, "bookmarkCount_median": 91.0, "quoteCount_total": 966.0, "quoteCount_mean": 37.1538461538, "quoteCount_median": 14.5, "engagement_rate": 0.008295707}, {"topic_id": 17, "topic_name": "Cryptocurrency Evolution", "tweet_count": 27, "keywords": ["secured", "onchain", "blockchain", "cryptography", "door"], "likeCount_total": 18817.0, "likeCount_mean": 784.0416666667, "likeCount_median": 410.0, "retweetCount_total": 2599.0, "retweetCount_mean": 108.2916666667, "retweetCount_median": 48.0, "replyCount_total": 1743.0, "replyCount_mean": 72.625, "replyCount_median": 26.5, "viewCount_total": 2602612.0, "viewCount_mean": 144589.5555555556, "viewCount_median": 78355.0, "bookmarkCount_total": 4015.0, "bookmarkCount_mean": 167.2916666667, "bookmarkCount_median": 29.0, "quoteCount_total": 670.0, "quoteCount_mean": 27.9166666667, "quoteCount_median": 7.0, "engagement_rate": 0.0088983683}, {"topic_id": 18, "topic_name": "Regulatory Overreach Challenges", "tweet_count": 27, "keywords": ["chevron", "vaccines", "vaccine", "fda", "health"], "likeCount_total": 7764.0, "likeCount_mean": 337.5652173913, "likeCount_median": 142.0, "retweetCount_total": 613.0, "retweetCount_mean": 26.652173913, "retweetCount_median": 3.0, "replyCount_total": 642.0, "replyCount_mean": 27.9130434783, "replyCount_median": 8.0, "viewCount_total": 4180787.0, "viewCount_mean": 181773.3478260869, "viewCount_median": 34421.0, "bookmarkCount_total": 519.0, "bookmarkCount_mean": 22.5652173913, "bookmarkCount_median": 4.0, "quoteCount_total": 130.0, "quoteCount_mean": 5.652173913, "quoteCount_median": 1.0, "engagement_rate": 0.0021572493}, {"topic_id": 19, "topic_name": "Global Geopolitical Shifts", "tweet_count": 32, "keywords": ["china", "taiwan", "chinese", "japan", "military"], "likeCount_total": 35295.0, "likeCount_mean": 1217.0689655172, "likeCount_median": 323.0, "retweetCount_total": 5411.0, "retweetCount_mean": 186.5862068966, "retweetCount_median": 34.0, "replyCount_total": 2637.0, "replyCount_mean": 90.9310344828, "replyCount_median": 19.0, "viewCount_total": 9297278.0, "viewCount_mean": 320595.7931034483, "viewCount_median": 88391.0, "bookmarkCount_total": 15461.0, "bookmarkCount_mean": 533.1379310345, "bookmarkCount_median": 50.0, "quoteCount_total": 1187.0, "quoteCount_mean": 40.9310344828, "quoteCount_median": 3.0, "engagement_rate": 0.0046619021}, {"topic_id": 20, "topic_name": "Real Estate Crisis", "tweet_count": 28, "keywords": ["debt", "real", "estate", "real estate", "crisis"], "likeCount_total": 47436.0, "likeCount_mean": 2496.6315789474, "likeCount_median": 846.0, "retweetCount_total": 7430.0, "retweetCount_mean": 391.0526315789, "retweetCount_median": 116.0, "replyCount_total": 3564.0, "replyCount_mean": 187.5789473684, "replyCount_median": 62.0, "viewCount_total": 8067478.0, "viewCount_mean": 448193.2222222222, "viewCount_median": 227849.0, "bookmarkCount_total": 7634.0, "bookmarkCount_mean": 401.7894736842, "bookmarkCount_median": 147.0, "quoteCount_total": 1239.0, "quoteCount_mean": 65.2105263158, "quoteCount_median": 13.0, "engagement_rate": 0.00724266}, {"topic_id": 21, "topic_name": "Foundational Thinking in Tech", "tweet_count": 27, "keywords": ["tech", "windsurf", "big", "big tech", "companies"], "likeCount_total": 24205.0, "likeCount_mean": 930.9615384615, "likeCount_median": 248.5, "retweetCount_total": 2209.0, "retweetCount_mean": 84.9615384615, "retweetCount_median": 22.5, "replyCount_total": 1311.0, "replyCount_mean": 50.4230769231, "replyCount_median": 26.0, "viewCount_total": 4010695.0, "viewCount_mean": 182304.3181818182, "viewCount_median": 86826.0, "bookmarkCount_total": 5574.0, "bookmarkCount_mean": 214.3846153846, "bookmarkCount_median": 30.5, "quoteCount_total": 329.0, "quoteCount_mean": 12.6538461538, "quoteCount_median": 2.0, "engagement_rate": 0.006912767}, {"topic_id": 22, "topic_name": "Higher Ed Finance Crisis", "tweet_count": 25, "keywords": ["harvard", "academia", "college", "replace", "crunch"], "likeCount_total": 16689.0, "likeCount_mean": 927.1666666667, "likeCount_median": 341.5, "retweetCount_total": 2264.0, "retweetCount_mean": 125.7777777778, "retweetCount_median": 25.5, "replyCount_total": 790.0, "replyCount_mean": 43.8888888889, "replyCount_median": 17.5, "viewCount_total": 2829459.0, "viewCount_mean": 188630.6, "viewCount_median": 54712.0, "bookmarkCount_total": 1788.0, "bookmarkCount_mean": 99.3333333333, "bookmarkCount_median": 25.0, "quoteCount_total": 270.0, "quoteCount_mean": 15.0, "quoteCount_median": 4.5, "engagement_rate": 0.006977659}, {"topic_id": 23, "topic_name": "Global Dollar Shift", "tweet_count": 30, "keywords": ["dedollarization", "taxation", "happening", "inflation", "global taxation"], "likeCount_total": 28498.0, "likeCount_mean": 982.6896551724, "likeCount_median": 210.0, "retweetCount_total": 5059.0, "retweetCount_mean": 174.4482758621, "retweetCount_median": 31.0, "replyCount_total": 1778.0, "replyCount_mean": 61.3103448276, "replyCount_median": 15.0, "viewCount_total": 6291460.0, "viewCount_mean": 224695.0, "viewCount_median": 99173.0, "bookmarkCount_total": 8380.0, "bookmarkCount_mean": 288.9655172414, "bookmarkCount_median": 21.0, "quoteCount_total": 777.0, "quoteCount_mean": 26.7931034483, "quoteCount_median": 5.0, "engagement_rate": 0.0056163434}, {"topic_id": 24, "topic_name": "Crypto and Culture", "tweet_count": 24, "keywords": ["youtube", "episode", "podcast", "spotify", "apple"], "likeCount_total": 7991.0, "likeCount_mean": 380.5238095238, "likeCount_median": 135.0, "retweetCount_total": 1029.0, "retweetCount_mean": 49.0, "retweetCount_median": 20.0, "replyCount_total": 574.0, "replyCount_mean": 27.3333333333, "replyCount_median": 10.0, "viewCount_total": 2171603.0, "viewCount_mean": 108580.15, "viewCount_median": 58207.0, "bookmarkCount_total": 4915.0, "bookmarkCount_mean": 234.0476190476, "bookmarkCount_median": 44.0, "quoteCount_total": 145.0, "quoteCount_mean": 6.9047619048, "quoteCount_median": 2.0, "engagement_rate": 0.0044179346}, {"topic_id": 25, "topic_name": "NATO Russia Tensions", "tweet_count": 18, "keywords": ["nato", "russia", "ukraine", "ammo", "china"], "likeCount_total": 10978.0, "likeCount_mean": 686.125, "likeCount_median": 92.0, "retweetCount_total": 1392.0, "retweetCount_mean": 87.0, "retweetCount_median": 6.0, "replyCount_total": 1228.0, "replyCount_mean": 76.75, "replyCount_median": 12.0, "viewCount_total": 3705623.0, "viewCount_mean": 231601.4375, "viewCount_median": 51805.0, "bookmarkCount_total": 4510.0, "bookmarkCount_mean": 281.875, "bookmarkCount_median": 4.0, "quoteCount_total": 429.0, "quoteCount_mean": 26.8125, "quoteCount_median": 2.5, "engagement_rate": 0.0036695584}, {"topic_id": 26, "topic_name": "Link Collections", "tweet_count": 18, "keywords": ["heres", "version", "long form", "form version", "form"], "likeCount_total": 7960.0, "likeCount_mean": 568.5714285714, "likeCount_median": 105.0, "retweetCount_total": 834.0, "retweetCount_mean": 59.5714285714, "retweetCount_median": 9.5, "replyCount_total": 199.0, "replyCount_mean": 14.2142857143, "replyCount_median": 6.5, "viewCount_total": 1643965.0, "viewCount_mean": 117426.0714285714, "viewCount_median": 53883.5, "bookmarkCount_total": 3531.0, "bookmarkCount_mean": 252.2142857143, "bookmarkCount_median": 20.5, "quoteCount_total": 77.0, "quoteCount_mean": 5.5, "quoteCount_median": 1.0, "engagement_rate": 0.0054703111}, {"topic_id": 27, "topic_name": "Tariff Impact Assessment", "tweet_count": 18, "keywords": ["tariffs", "tariff", "parts", "quality", "tariffs arent"], "likeCount_total": 28175.0, "likeCount_mean": 1878.3333333333, "likeCount_median": 255.0, "retweetCount_total": 8386.0, "retweetCount_mean": 559.0666666667, "retweetCount_median": 230.0, "replyCount_total": 2205.0, "replyCount_mean": 147.0, "replyCount_median": 29.0, "viewCount_total": 6166133.0, "viewCount_mean": 411075.5333333333, "viewCount_median": 92223.0, "bookmarkCount_total": 8246.0, "bookmarkCount_mean": 549.7333333333, "bookmarkCount_median": 24.0, "quoteCount_total": 764.0, "quoteCount_mean": 50.9333333333, "quoteCount_median": 2.0, "engagement_rate": 0.0062869225}, {"topic_id": 28, "topic_name": "Social Media Critique", "tweet_count": 18, "keywords": ["twitter", "threads", "instagram", "social", "tweet"], "likeCount_total": 4599.0, "likeCount_mean": 328.5, "likeCount_median": 199.5, "retweetCount_total": 451.0, "retweetCount_mean": 32.2142857143, "retweetCount_median": 23.5, "replyCount_total": 315.0, "replyCount_mean": 22.5, "replyCount_median": 15.5, "viewCount_total": 841743.0, "viewCount_mean": 76522.0909090909, "viewCount_median": 67957.0, "bookmarkCount_total": 350.0, "bookmarkCount_mean": 25.0, "bookmarkCount_median": 12.0, "quoteCount_total": 82.0, "quoteCount_mean": 5.8571428571, "quoteCount_median": 3.0, "engagement_rate": 0.0063736794}, {"topic_id": 29, "topic_name": "Mobile Device Options", "tweet_count": 17, "keywords": ["app", "apple", "android", "store", "iphone"], "likeCount_total": 5548.0, "likeCount_mean": 396.2857142857, "likeCount_median": 191.5, "retweetCount_total": 716.0, "retweetCount_mean": 51.1428571429, "retweetCount_median": 14.0, "replyCount_total": 445.0, "replyCount_mean": 31.7857142857, "replyCount_median": 13.5, "viewCount_total": 1243775.0, "viewCount_mean": 177682.1428571429, "viewCount_median": 52536.0, "bookmarkCount_total": 445.0, "bookmarkCount_mean": 31.7857142857, "bookmarkCount_median": 8.0, "quoteCount_total": 161.0, "quoteCount_mean": 11.5, "quoteCount_median": 3.0, "engagement_rate": 0.0053940624}, {"topic_id": 30, "topic_name": "Digital Identity Paradigm", "tweet_count": 17, "keywords": ["passport", "private", "access", "citizenship", "logins"], "likeCount_total": 5879.0, "likeCount_mean": 419.9285714286, "likeCount_median": 246.0, "retweetCount_total": 582.0, "retweetCount_mean": 41.5714285714, "retweetCount_median": 19.5, "replyCount_total": 432.0, "replyCount_mean": 30.8571428571, "replyCount_median": 12.5, "viewCount_total": 484800.0, "viewCount_mean": 96960.0, "viewCount_median": 91153.0, "bookmarkCount_total": 1025.0, "bookmarkCount_mean": 73.2142857143, "bookmarkCount_median": 20.5, "quoteCount_total": 161.0, "quoteCount_mean": 11.5, "quoteCount_median": 2.5, "engagement_rate": 0.0142182343}, {"topic_id": 31, "topic_name": "California Decline Fears", "tweet_count": 17, "keywords": ["california", "californias", "500k", "ca", "300m bus"], "likeCount_total": 8440.0, "likeCount_mean": 649.2307692308, "likeCount_median": 323.0, "retweetCount_total": 907.0, "retweetCount_mean": 69.7692307692, "retweetCount_median": 29.0, "replyCount_total": 1002.0, "replyCount_mean": 77.0769230769, "replyCount_median": 16.0, "viewCount_total": 2906442.0, "viewCount_mean": 223572.4615384615, "viewCount_median": 145826.0, "bookmarkCount_total": 682.0, "bookmarkCount_mean": 52.4615384615, "bookmarkCount_median": 12.0, "quoteCount_total": 260.0, "quoteCount_mean": 20.0, "quoteCount_median": 1.0, "engagement_rate": 0.003560711}, {"topic_id": 32, "topic_name": "Life in Cities", "tweet_count": 16, "keywords": ["httpstcor7i1lbrxdb", "people live", "httpstcogev4pdixml", "httpstco7y6o096mqg", "background"], "likeCount_total": 6411.0, "likeCount_mean": 801.375, "likeCount_median": 198.0, "retweetCount_total": 601.0, "retweetCount_mean": 75.125, "retweetCount_median": 24.0, "replyCount_total": 324.0, "replyCount_mean": 40.5, "replyCount_median": 11.5, "viewCount_total": 1740031.0, "viewCount_mean": 217503.875, "viewCount_median": 126269.0, "bookmarkCount_total": 1061.0, "bookmarkCount_mean": 132.625, "bookmarkCount_median": 41.0, "quoteCount_total": 114.0, "quoteCount_mean": 14.25, "quoteCount_median": 1.0, "engagement_rate": 0.0042160168}, {"topic_id": 33, "topic_name": "Ledger of Record", "tweet_count": 14, "keywords": ["onchain", "ledger", "accounting", "trust", "record"], "likeCount_total": 5985.0, "likeCount_mean": 460.3846153846, "likeCount_median": 140.0, "retweetCount_total": 834.0, "retweetCount_mean": 64.1538461538, "retweetCount_median": 16.0, "replyCount_total": 495.0, "replyCount_mean": 38.0769230769, "replyCount_median": 15.0, "viewCount_total": 389899.0, "viewCount_mean": 64983.1666666667, "viewCount_median": 53870.0, "bookmarkCount_total": 666.0, "bookmarkCount_mean": 51.2307692308, "bookmarkCount_median": 16.0, "quoteCount_total": 168.0, "quoteCount_mean": 12.9230769231, "quoteCount_median": 2.0, "engagement_rate": 0.0187587042}, {"topic_id": 34, "topic_name": "Australia's Future Prospects", "tweet_count": 14, "keywords": ["australia", "zealand", "new zealand", "australia new", "asset sales"], "likeCount_total": 10169.0, "likeCount_mean": 924.4545454545, "likeCount_median": 432.0, "retweetCount_total": 1068.0, "retweetCount_mean": 97.0909090909, "retweetCount_median": 35.0, "replyCount_total": 619.0, "replyCount_mean": 56.2727272727, "replyCount_median": 28.0, "viewCount_total": 3251363.0, "viewCount_mean": 295578.4545454545, "viewCount_median": 145359.0, "bookmarkCount_total": 1038.0, "bookmarkCount_mean": 94.3636363636, "bookmarkCount_median": 30.0, "quoteCount_total": 163.0, "quoteCount_mean": 14.8181818182, "quoteCount_median": 5.0, "engagement_rate": 0.0036464707}, {"topic_id": 35, "topic_name": "Nuclear Power Debate", "tweet_count": 14, "keywords": ["nuclear", "nuclear weapons", "iraq", "lots", "weapons"], "likeCount_total": 3011.0, "likeCount_mean": 273.7272727273, "likeCount_median": 31.0, "retweetCount_total": 394.0, "retweetCount_mean": 35.8181818182, "retweetCount_median": 3.0, "replyCount_total": 128.0, "replyCount_mean": 11.6363636364, "replyCount_median": 5.0, "viewCount_total": 523122.0, "viewCount_mean": 47556.5454545455, "viewCount_median": 2142.0, "bookmarkCount_total": 202.0, "bookmarkCount_mean": 18.3636363636, "bookmarkCount_median": 3.0, "quoteCount_total": 27.0, "quoteCount_mean": 2.4545454545, "quoteCount_median": 1.0, "engagement_rate": 0.0067536827}, {"topic_id": 36, "topic_name": "Decentralizing Education Systems", "tweet_count": 13, "keywords": ["decentralization", "centralization", "education", "k12", "west"], "likeCount_total": 2729.0, "likeCount_mean": 209.9230769231, "likeCount_median": 197.0, "retweetCount_total": 289.0, "retweetCount_mean": 22.2307692308, "retweetCount_median": 19.0, "replyCount_total": 203.0, "replyCount_mean": 15.6153846154, "replyCount_median": 12.0, "viewCount_total": 344591.0, "viewCount_mean": 38287.8888888889, "viewCount_median": 33361.0, "bookmarkCount_total": 474.0, "bookmarkCount_mean": 36.4615384615, "bookmarkCount_median": 17.0, "quoteCount_total": 44.0, "quoteCount_mean": 3.3846153846, "quoteCount_median": 2.0, "engagement_rate": 0.0093473132}, {"topic_id": 37, "topic_name": "Economic Data Visualized", "tweet_count": 12, "keywords": ["graph", "graphs", "graph shows", "spike", "underlying"], "likeCount_total": 1533.0, "likeCount_mean": 191.625, "likeCount_median": 86.5, "retweetCount_total": 119.0, "retweetCount_mean": 14.875, "retweetCount_median": 8.0, "replyCount_total": 138.0, "replyCount_mean": 17.25, "replyCount_median": 8.5, "viewCount_total": 1098130.0, "viewCount_mean": 137266.25, "viewCount_median": 34439.5, "bookmarkCount_total": 197.0, "bookmarkCount_mean": 24.625, "bookmarkCount_median": 7.0, "quoteCount_total": 28.0, "quoteCount_mean": 3.5, "quoteCount_median": 0.0, "engagement_rate": 0.0016300438}, {"topic_id": 38, "topic_name": "Tech vs Blue America", "tweet_count": 13, "keywords": ["blue", "red", "state blue", "money blue", "academia blue"], "likeCount_total": 8949.0, "likeCount_mean": 1118.625, "likeCount_median": 568.0, "retweetCount_total": 786.0, "retweetCount_mean": 98.25, "retweetCount_median": 64.0, "replyCount_total": 770.0, "replyCount_mean": 96.25, "replyCount_median": 19.5, "viewCount_total": 1841583.0, "viewCount_mean": 230197.875, "viewCount_median": 189374.0, "bookmarkCount_total": 1172.0, "bookmarkCount_mean": 146.5, "bookmarkCount_median": 84.0, "quoteCount_total": 228.0, "quoteCount_mean": 28.5, "quoteCount_median": 5.5, "engagement_rate": 0.0057043315}, {"topic_id": 39, "topic_name": "China Shipbuilding Dominance", "tweet_count": 12, "keywords": ["navy", "ships", "shipbuilding", "shipbuilding capacity", "capacity"], "likeCount_total": 4187.0, "likeCount_mean": 418.7, "likeCount_median": 204.0, "retweetCount_total": 720.0, "retweetCount_mean": 72.0, "retweetCount_median": 25.5, "replyCount_total": 369.0, "replyCount_mean": 36.9, "replyCount_median": 19.0, "viewCount_total": 2057794.0, "viewCount_mean": 205779.4, "viewCount_median": 92204.5, "bookmarkCount_total": 661.0, "bookmarkCount_mean": 66.1, "bookmarkCount_median": 14.5, "quoteCount_total": 186.0, "quoteCount_mean": 18.6, "quoteCount_median": 7.5, "engagement_rate": 0.0025639107}, {"topic_id": 40, "topic_name": "Macron Durov Controversy", "tweet_count": 12, "keywords": ["france", "macron", "telegram", "durov", "french"], "likeCount_total": 136.0, "likeCount_mean": 68.0, "likeCount_median": 68.0, "retweetCount_total": 14.0, "retweetCount_mean": 7.0, "retweetCount_median": 7.0, "replyCount_total": 10.0, "replyCount_mean": 5.0, "replyCount_median": 5.0, "viewCount_total": 29046.0, "viewCount_mean": 29046.0, "viewCount_median": 29046.0, "bookmarkCount_total": 12.0, "bookmarkCount_mean": 6.0, "bookmarkCount_median": 6.0, "quoteCount_total": 5.0, "quoteCount_mean": 2.5, "quoteCount_median": 2.5, "engagement_rate": 0.0055085038}, {"topic_id": 41, "topic_name": "USDC Stablecoin Launch", "tweet_count": 11, "keywords": ["usdc", "coinbase", "circle", "2018", "launch"], "likeCount_total": 3608.0, "likeCount_mean": 360.8, "likeCount_median": 118.5, "retweetCount_total": 933.0, "retweetCount_mean": 93.3, "retweetCount_median": 14.0, "replyCount_total": 179.0, "replyCount_mean": 17.9, "replyCount_median": 11.0, "viewCount_total": 1125511.0, "viewCount_mean": 112551.1, "viewCount_median": 69113.0, "bookmarkCount_total": 844.0, "bookmarkCount_mean": 84.4, "bookmarkCount_median": 16.5, "quoteCount_total": 55.0, "quoteCount_mean": 5.5, "quoteCount_median": 2.5, "engagement_rate": 0.0041936507}, {"topic_id": 42, "topic_name": "Alternative Progress Strategies", "tweet_count": 11, "keywords": ["golden", "energy", "fighting", "100", "progress"], "likeCount_total": 9054.0, "likeCount_mean": 905.4, "likeCount_median": 219.0, "retweetCount_total": 1168.0, "retweetCount_mean": 116.8, "retweetCount_median": 21.0, "replyCount_total": 701.0, "replyCount_mean": 70.1, "replyCount_median": 26.0, "viewCount_total": 3101351.0, "viewCount_mean": 310135.1, "viewCount_median": 74974.0, "bookmarkCount_total": 2357.0, "bookmarkCount_mean": 235.7, "bookmarkCount_median": 26.5, "quoteCount_total": 206.0, "quoteCount_mean": 20.6, "quoteCount_median": 5.0, "engagement_rate": 0.0035220135}, {"topic_id": 43, "topic_name": "Popups as New Startups", "tweet_count": 11, "keywords": ["popups", "popups new", "new startups", "startup societies", "startups"], "likeCount_total": 9585.0, "likeCount_mean": 871.3636363636, "likeCount_median": 431.0, "retweetCount_total": 836.0, "retweetCount_mean": 76.0, "retweetCount_median": 45.0, "replyCount_total": 949.0, "replyCount_mean": 86.2727272727, "replyCount_median": 52.0, "viewCount_total": 4423430.0, "viewCount_mean": 402130.0, "viewCount_median": 106291.0, "bookmarkCount_total": 2935.0, "bookmarkCount_mean": 266.8181818182, "bookmarkCount_median": 62.0, "quoteCount_total": 270.0, "quoteCount_mean": 24.5454545455, "quoteCount_median": 4.0, "engagement_rate": 0.0025704035}, {"topic_id": 44, "topic_name": "Financial Free Zones", "tweet_count": 11, "keywords": ["singapore", "dubai", "london", "miami", "dubai singapore"], "likeCount_total": 27936.0, "likeCount_mean": 2539.6363636364, "likeCount_median": 845.0, "retweetCount_total": 4050.0, "retweetCount_mean": 368.1818181818, "retweetCount_median": 115.0, "replyCount_total": 1440.0, "replyCount_mean": 130.9090909091, "replyCount_median": 49.0, "viewCount_total": 8231213.0, "viewCount_mean": 823121.3, "viewCount_median": 195044.5, "bookmarkCount_total": 7285.0, "bookmarkCount_mean": 662.2727272727, "bookmarkCount_median": 158.0, "quoteCount_total": 694.0, "quoteCount_mean": 63.0909090909, "quoteCount_median": 17.0, "engagement_rate": 0.0040608839}, {"topic_id": 45, "topic_name": "Bot Security Threats", "tweet_count": 11, "keywords": ["bot", "trust", "password", "submit", "accelerates"], "likeCount_total": 1967.0, "likeCount_mean": 245.875, "likeCount_median": 169.5, "retweetCount_total": 168.0, "retweetCount_mean": 21.0, "retweetCount_median": 15.0, "replyCount_total": 177.0, "replyCount_mean": 22.125, "replyCount_median": 15.0, "viewCount_total": 263245.0, "viewCount_mean": 87748.3333333333, "viewCount_median": 78225.0, "bookmarkCount_total": 120.0, "bookmarkCount_mean": 15.0, "bookmarkCount_median": 11.5, "quoteCount_total": 30.0, "quoteCount_mean": 3.75, "quoteCount_median": 1.5, "engagement_rate": 0.0087826929}];
        
        let currentSort = 'engagement_rate';
        let sortAsc = false;
        let normalizeBy = 'column';
        
        const metrics = ['likeCount_mean', 'retweetCount_mean', 'replyCount_mean', 'bookmarkCount_mean', 'engagement_rate'];
        const metricLabels = {
            'likeCount_mean': 'Avg Likes',
            'retweetCount_mean': 'Avg Retweets',
            'replyCount_mean': 'Avg Replies',
            'bookmarkCount_mean': 'Avg Saves',
            'engagement_rate': 'Engagement Rate'
        };
        
        function getColor(value, min, max) {
            if (max === min) return 'rgba(0, 217, 255, 0.3)';
            const norm = (value - min) / (max - min);
            
            // Low: dark blue, Mid: cyan, High: purple
            if (norm < 0.5) {
                const t = norm * 2;
                return `rgba(${Math.round(0 + t * 0)}, ${Math.round(50 + t * 167)}, ${Math.round(100 + t * 155)}, ${0.3 + norm * 0.5})`;
            } else {
                const t = (norm - 0.5) * 2;
                return `rgba(${Math.round(0 + t * 168)}, ${Math.round(217 - t * 132)}, ${Math.round(255 - t * 8)}, ${0.3 + norm * 0.5})`;
            }
        }
        
        function formatValue(value, metric) {
            if (metric === 'engagement_rate') {
                return (value * 100).toFixed(2) + '%';
            } else if (value >= 1000000) {
                return (value / 1000000).toFixed(1) + 'M';
            } else if (value >= 1000) {
                return (value / 1000).toFixed(1) + 'K';
            }
            return Math.round(value).toLocaleString();
        }
        
        function renderHeatmap() {
            const sorted = [...topicData].sort((a, b) => {
                const av = a[currentSort] || 0;
                const bv = b[currentSort] || 0;
                return sortAsc ? av - bv : bv - av;
            });
            
            // Compute min/max for normalization
            const ranges = {};
            if (normalizeBy === 'column') {
                metrics.forEach(m => {
                    const values = sorted.map(d => d[m] || 0);
                    ranges[m] = { min: Math.min(...values), max: Math.max(...values) };
                });
            }
            
            const tbody = document.getElementById('heatmapBody');
            tbody.innerHTML = sorted.map(topic => {
                // Row-based normalization
                let rowMin, rowMax;
                if (normalizeBy === 'row') {
                    const rowValues = metrics.filter(m => m !== 'engagement_rate').map(m => topic[m] || 0);
                    rowMin = Math.min(...rowValues);
                    rowMax = Math.max(...rowValues);
                }
                
                const cells = metrics.map(m => {
                    const value = topic[m] || 0;
                    let min, max;
                    if (normalizeBy === 'column') {
                        min = ranges[m].min;
                        max = ranges[m].max;
                    } else {
                        if (m === 'engagement_rate') {
                            min = ranges[m]?.min || 0;
                            max = ranges[m]?.max || 1;
                        } else {
                            min = rowMin;
                            max = rowMax;
                        }
                    }
                    const color = getColor(value, min, max);
                    return `<td>
                        <div class="heat-cell" style="background: ${color};" 
                             data-topic="${topic.topic_name}"
                             data-metric="${metricLabels[m]}"
                             data-value="${formatValue(value, m)}"
                             data-total="${formatValue(topic[m.replace('_mean', '_total')] || value, m)}">
                            <span class="heat-value">${formatValue(value, m)}</span>
                        </div>
                    </td>`;
                }).join('');
                
                return `<tr>
                    <td>
                        <div class="topic-cell">
                            <span class="topic-name">${topic.topic_name}</span>
                            <span class="topic-keywords">${topic.keywords.join(' • ')}</span>
                            <span class="topic-count">${topic.tweet_count} tweets</span>
                        </div>
                    </td>
                    ${cells}
                </tr>`;
            }).join('');
            
            // Update header classes
            document.querySelectorAll('th[data-col]').forEach(th => {
                th.classList.remove('sorted', 'asc');
                if (th.dataset.col === currentSort) {
                    th.classList.add('sorted');
                    if (sortAsc) th.classList.add('asc');
                }
            });
        }
        
        // Tooltip
        const tooltip = document.getElementById('tooltip');
        document.addEventListener('mouseover', e => {
            const cell = e.target.closest('.heat-cell');
            if (cell) {
                tooltip.innerHTML = `
                    <div class="tooltip-title">${cell.dataset.topic}</div>
                    <div class="tooltip-row">
                        <span class="tooltip-label">${cell.dataset.metric}:</span>
                        <span class="tooltip-value">${cell.dataset.value}</span>
                    </div>
                `;
                tooltip.style.display = 'block';
            }
        });
        
        document.addEventListener('mousemove', e => {
            if (tooltip.style.display === 'block') {
                tooltip.style.left = (e.clientX + 15) + 'px';
                tooltip.style.top = (e.clientY + 15) + 'px';
            }
        });
        
        document.addEventListener('mouseout', e => {
            if (e.target.closest('.heat-cell')) {
                tooltip.style.display = 'none';
            }
        });
        
        // Sort by clicking headers
        document.querySelectorAll('th[data-col]').forEach(th => {
            th.addEventListener('click', () => {
                const col = th.dataset.col;
                if (currentSort === col) {
                    sortAsc = !sortAsc;
                } else {
                    currentSort = col;
                    sortAsc = false;
                }
                document.getElementById('sortBy').value = col;
                renderHeatmap();
            });
        });
        
        // Controls
        document.getElementById('sortBy').addEventListener('change', e => {
            currentSort = e.target.value;
            sortAsc = false;
            renderHeatmap();
        });
        
        document.getElementById('normalizeBy').addEventListener('change', e => {
            normalizeBy = e.target.value;
            renderHeatmap();
        });
        
        // Initial render
        renderHeatmap();
    </script>
</body>
</html>